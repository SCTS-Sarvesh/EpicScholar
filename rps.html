<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rock Paper Scissors - Ultimate Edition</title>
  <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700;800&family=Material+Icons&display=swap" rel="stylesheet">
  <style>
    /*
     * ----------------------------------------------------
     * 1. THEME & VARIABLE DEFINITIONS
     * ----------------------------------------------------
     */
    :root {
      /* Shared Gradient for Blobs, Titles, and Accents */
      --primary-gradient: linear-gradient(135deg, #0072ff 0%, #ff416c 100%);
      --primary-color: #0072ff;
      --accent-color: #ff416c;
      
      /* Theme Variables (Light/Dark Switch) */
      --bg-color-light: #f5f5f5;
      --bg-color-dark: #000; /* Requested Black Background */
      --text-light: #222;
      --text-dark: #eee;
      --container-light: rgba(255, 255, 255, 0.9);
      --container-dark: rgba(25, 25, 25, 0.9);
      
      /* Glassmorphism/iOS Polish */
      --blur: blur(25px);
      --card-shadow: 0 10px 40px rgba(0,0,0,0.3);
      --pop-transform: translateY(-4px) scale(1.02);
      /* Custom cubic-bezier for snappy, bouncy feel */
      --transition-fast: all 0.2s cubic-bezier(0.4, 0.8, 0.6, 1.2);
      --transition-smooth: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      --transition-bouncy: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    /* ----------------------------------------------------
     * 2. BASE STYLING & BACKGROUND ANIMATION
     * ----------------------------------------------------
     */
    body {
      font-family: 'Google Sans', 'Segoe UI', sans-serif;
      background-color: var(--bg-color-light);
      color: var(--text-light);
      text-align: center;
      min-height: 100vh;
      overflow: hidden;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      transition: background-color 0.8s ease, color 0.8s ease;
      position: relative;
    }

    body.dark-mode {
      background-color: var(--bg-color-dark);
      color: var(--text-dark);
    }
    
    /* Blob Animation Keyframes */
    @keyframes moveBlob1 {
      0%, 100% { transform: translate(0, 0) scale(1.1); }
      30% { transform: translate(-5vw, 15vh) scale(0.9); }
      60% { transform: translate(5vw, -10vh) scale(1.2); }
    }
    
    @keyframes moveBlob2 {
      0%, 100% { transform: translate(0, 0) scale(1); }
      40% { transform: translate(10vw, -10vh) scale(1.1); }
      70% { transform: translate(-10vw, 10vh) scale(0.9); }
    }

    @keyframes moveBlob3 {
      0%, 100% { transform: translate(0, 0) scale(1.2); }
      25% { transform: translate(5vw, 5vh) scale(1); }
      80% { transform: translate(-15vw, -5vh) scale(1.1); }
    }

    /* The Glass Blobs Containers */
    .blob-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      overflow: hidden;
      z-index: 0;
      opacity: 0.8;
      transition: opacity 0.8s ease;
    }

    body.dark-mode .blob-container {
      opacity: 0.5;
    }

    .blob {
      position: absolute;
      width: 400px;
      height: 400px;
      border-radius: 50%;
      background: var(--primary-gradient); 
      filter: blur(150px);
      transition: opacity 0.5s ease;
    }

    #blob1 {
      top: 10%;
      left: 10%;
      animation: moveBlob1 20s infinite alternate;
    }

    #blob2 {
      bottom: 20%;
      right: 15%;
      animation: moveBlob2 24s infinite alternate-reverse;
    }

    #blob3 {
      top: 60%;
      left: 30%;
      animation: moveBlob3 18s infinite alternate;
    }
    
    /* ----------------------------------------------------
     * 3. UI CONTROLS & UTILITY
     * ----------------------------------------------------
     */
    
    .ui-controls-top {
      position: fixed;
      top: 20px;
      left: 20px; 
      right: auto;
      display: flex;
      gap: 12px;
      z-index: 100;
    }

    .ui-controls-right {
        position: fixed;
        top: 20px;
        right: 20px;
        display: flex;
        gap: 12px;
        z-index: 100;
    }

    .icon-btn {
      background: var(--container-light);
      border: none;
      border-radius: 50%;
      width: 48px;
      height: 48px;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition-smooth);
      color: var(--primary-color);
      font-size: 1.5rem;
      text-decoration: none;
    }

    .dark-mode .icon-btn {
      background: var(--container-dark);
      color: var(--text-dark);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    .icon-btn:hover {
      transform: scale(1.1) rotate(10deg);
      box-shadow: 0 8px 20px rgba(0, 114, 255, 0.4);
    }
    
    /* Hidden utility class with smooth transition */
    .hidden-fade {
        opacity: 0;
        max-height: 0;
        padding: 0;
        margin: 0;
        overflow: hidden;
        pointer-events: none;
        transition: opacity 0.5s ease, max-height 0.5s ease;
    }
    
    .visible-fade {
        opacity: 1;
        max-height: 1000px; /* Sufficient height to show content */
        transition: opacity 0.8s ease 0.3s, max-height 0.5s ease;
    }
    
    .game-container {
      background: var(--container-light);
      padding: 2.5rem;
      border-radius: 2rem;
      box-shadow: var(--card-shadow);
      width: 90%;
      max-width: 500px;
      position: relative;
      backdrop-filter: var(--blur);
      -webkit-backdrop-filter: var(--blur);
      display: flex;
      flex-direction: column;
      align-items: center; 
      transition: var(--transition-smooth), box-shadow 0.5s;
      z-index: 10;
      animation: fadeIn 0.8s var(--transition-smooth);
    }

    .dark-mode .game-container {
      background: var(--container-dark);
      box-shadow: 0 10px 30px rgba(0,0,0,0.6);
    }

    .game-title {
      margin-top: 0;
      font-weight: 800;
      font-size: 2.5rem;
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 1.5rem;
      letter-spacing: -1px;
      transition: var(--transition-smooth);
    }

    /* --- Buttons & Inputs --- */
    .btn {
      padding: 18px;
      border: none;
      border-radius: 18px;
      font-size: 1.1rem;
      font-weight: 800;
      cursor: pointer;
      transition: var(--transition-fast);
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      text-decoration: none;
      box-sizing: border-box;
      letter-spacing: 0.5px;
    }

    .primary-btn {
      background: var(--primary-gradient);
      color: white;
      box-shadow: 0 4px 15px rgba(0, 114, 255, 0.3);
    }

    .primary-btn:hover {
      transform: var(--pop-transform);
      box-shadow: 0 10px 25px rgba(255, 65, 108, 0.4);
    }

    .secondary-btn {
      background: transparent;
      border: 2px solid var(--accent-color); 
      color: var(--accent-color);
      margin-top: 10px;
      transition: var(--transition-fast);
    }

    .secondary-btn:hover {
      background: var(--accent-color);
      color: white;
      transform: var(--pop-transform);
      box-shadow: 0 10px 20px rgba(255, 65, 108, 0.3);
    }

    .pop-input {
      width: 100%;
      padding: 18px;
      border-radius: 16px;
      border: 3px solid rgba(0, 114, 255, 0.1); 
      background: #ffffff;
      font-family: 'Google Sans', sans-serif;
      font-size: 1.4rem;
      font-weight: 800;
      text-align: center;
      color: var(--primary-color);
      transition: var(--transition-fast);
      box-sizing: border-box;
      box-shadow: 0 4px 10px rgba(0,0,0,0.03);
    }

    .dark-mode .pop-input {
      background: rgba(255, 255, 255, 0.05);
      border-color: rgba(255, 255, 255, 0.1);
      color: var(--text-dark);
    }
    
    .pop-input::placeholder {
        color: rgba(0, 114, 255, 0.4); 
    }
    .dark-mode .pop-input::placeholder {
        color: rgba(255, 255, 255, 0.6); 
    }
    
    /* Difficulty Selector */
    .difficulty-selector {
      display: flex;
      gap: 10px;
    }

    .diff-btn {
      flex: 1;
      padding: 14px;
      border: 2px solid rgba(0, 0, 0, 0.1);
      border-radius: 16px;
      background: transparent;
      cursor: pointer;
      font-weight: 700;
      transition: var(--transition-fast);
      color: #888;
      font-size: 1rem;
    }

    .dark-mode .diff-btn {
      border-color: rgba(255, 255, 255, 0.1);
      color: #aaa;
    }

    .diff-btn.selected {
      background: var(--primary-gradient);
      color: white;
      border-color: transparent;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 114, 255, 0.3);
    }
    
    .diff-btn:hover:not(.selected) {
        transform: translateY(-4px) scale(1.02);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    /* ----------------------------------------------------
     * 4. GAME PLAY SECTION
     * ----------------------------------------------------
     */
    
    #game-area {
        width: 100%; 
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 0 10px; 
        box-sizing: border-box;
        transition: var(--transition-smooth);
    }

    /* Scoreboard */
    .scoreboard {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        width: 100%; 
        max-width: 400px; 
    }
    
    .score-box {
        background: rgba(255,255,255,0.1);
        padding: 1rem;
        border-radius: 1rem;
        min-width: 90px;
        transition: var(--transition-smooth);
        animation: scorePop 0.3s ease-out; /* Score update animation */
    }
    
    .dark-mode .score-box {
        background: rgba(255,255,255,0.05); 
    }

    .score-box p {
      font-weight: 600;
      margin: 0;
      color: var(--text-light); 
      transition: color 0.5s;
    }

    .dark-mode .score-box p {
      color: var(--text-dark); 
    }

    .score-number {
      font-size: 3rem;
      font-weight: 800;
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      transition: var(--transition-smooth);
    }
    
    @keyframes scorePop {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
    }

    /* Hands Animation Stage */
    .hands-stage {
      display: flex;
      justify-content: space-between;
      margin: 2rem 0;
      height: 150px;
      align-items: center;
      width: 100%;
      max-width: 400px;
      transition: var(--transition-smooth);
    }

    .hand {
      font-size: 5rem;
      display: block;
      transition: transform 0.2s;
      filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
    }

    #playerHand { transform: rotate(90deg); }
    #computerHand { transform: rotate(-90deg) scaleX(-1); }

    /* Shake Animation - Smoother 1s shake */
    .shake-player { animation: shakePlayer 1s ease-in-out; }
    .shake-computer { animation: shakeComputer 1s ease-in-out; }

/* Shake Animation - Adjusted to 3 distinct back-and-forth movements (6 steps) */
.shake-player { animation: shakePlayer 1s ease-in-out; }
.shake-computer { animation: shakeComputer 1s ease-in-out; }

@keyframes shakePlayer {
  /* 0: Start */
  0% { transform: rotate(90deg) translateY(0); }
  /* 1st shake out */
  20% { transform: rotate(90deg) translateY(-20px) scale(1.05); } 
  /* 1st shake in */
  40% { transform: rotate(90deg) translateY(0) scale(1); }
  /* 2nd shake out */
  60% { transform: rotate(90deg) translateY(-20px) scale(1.05); }
  /* 2nd shake in */
  80% { transform: rotate(90deg) translateY(0) scale(1); }
  /* 3rd shake out (final position, ready for result) */
  100% { transform: rotate(90deg) translateY(-20px) scale(1.05); } 
}

@keyframes shakeComputer {
  /* 0: Start */
  0% { transform: rotate(-90deg) scaleX(-1) translateY(0); }
  /* 1st shake out */
  20% { transform: rotate(-90deg) scaleX(-1) translateY(-20px) scale(1.05); }
  /* 1st shake in */
  40% { transform: rotate(-90deg) scaleX(-1) translateY(0) scale(1); }
  /* 2nd shake out */
  60% { transform: rotate(-90deg) scaleX(-1) translateY(-20px) scale(1.05); }
  /* 2nd shake in */
  80% { transform: rotate(-90deg) scaleX(-1) translateY(0) scale(1); }
  /* 3rd shake out (final position, ready for result) */
  100% { transform: rotate(-90deg) scaleX(-1) translateY(-20px) scale(1.05); }
}

    /* Round Status */
    #round-status {
        font-size: 1.5rem; 
        color: var(--text-light);
        transition: color 0.5s, transform 0.3s;
        min-height: 40px; /* Prevent layout shift */
        line-height: 1.2;
    }

    .dark-mode #round-status {
        color: var(--text-dark);
    }
    
    /* Choice Buttons */
    .choices {
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      margin-top: 2rem;
      width: 100%;
      max-width: 400px;
      transition: var(--transition-smooth);
    }
    
    .choice-btn {
      background: var(--container-light);
      border: 2px solid transparent;
      border-radius: 24px;
      padding: 16px;
      width: 110px;
      cursor: pointer;
      transition: var(--transition-fast);
      display: flex;
      flex-direction: column;
      align-items: center;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }
    
    .dark-mode .choice-btn {
      background: rgba(255,255,255,0.05);
    }
    
    .choice-btn span {
        font-weight: 700;
        color: #555;
        font-size: 0.9rem;
        transition: color 0.5s;
    }

    .dark-mode .choice-btn span {
        color: var(--text-dark);
    }

    .choice-btn:hover {
      transform: translateY(-10px);
      box-shadow: 0 15px 30px rgba(0, 114, 255, 0.15);
      border-color: var(--primary-color);
    }
    
    .choice-btn.disabled {
        pointer-events: none;
        opacity: 0.5;
        transform: none !important;
        box-shadow: none !important;
    }

    /* --- Timer Styles --- */
    .timer-display {
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      font-weight: 800; 
      color: var(--accent-color); 
      font-size: 1.1rem;
      transition: var(--transition-smooth);
    }
    
    /* ----------------------------------------------------
     * 5. MODALS & OVERLAYS
     * ----------------------------------------------------
     */
    
    .modal-overlay, .overlay-result {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(10px);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 300;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.4s ease, visibility 0s 0.4s;
    }

    .modal-overlay.active, .overlay-result:not(.hidden) {
      opacity: 1;
      visibility: visible;
      transition: opacity 0.4s ease;
    }

    .modal-card, .result-card {
      background: var(--container-light);
      padding: 2.5rem;
      border-radius: 2rem;
      width: 90%;
      max-width: 450px;
      box-shadow: 0 25px 60px rgba(0,0,0,0.4);
      transform: translateY(20px) scale(0.95);
      transition: var(--transition-bouncy);
      text-align: left;
      color: var(--text-light);
    }

    .dark-mode .modal-card, .dark-mode .result-card {
        background: var(--container-dark);
        color: var(--text-dark);
    }
    
    .modal-overlay.active .modal-card, .overlay-result:not(.hidden) .result-card {
      transform: translateY(0) scale(1);
    }

    /* Guide Steps Styling */
    .guide-steps .step {
        display: flex;
        align-items: flex-start;
        gap: 15px;
        margin-bottom: 20px;
        background: rgba(0, 114, 255, 0.05);
        padding: 12px;
        border-radius: 12px;
        transition: background 0.5s;
    }

    .dark-mode .guide-steps .step {
        background: rgba(255, 255, 255, 0.05);
    }

    .guide-steps .step p {
        margin: 0;
        font-size: 0.95rem;
        line-height: 1.5;
        color: var(--text-light);
        transition: color 0.5s;
    }

    .dark-mode .guide-steps .step p {
        color: var(--text-dark);
    }

    .final-message {
        background: var(--primary-gradient); 
        -webkit-background-clip: text; 
        -webkit-text-fill-color: transparent; 
        font-size: 2.5rem; 
        margin: 10px 0;
        animation: pulseGradient 4s infinite;
    }

    @keyframes pulseGradient {
        0% { filter: hue-rotate(0deg); }
        50% { filter: hue-rotate(45deg); }
        100% { filter: hue-rotate(0deg); }
    }
    
    .hidden { display: none !important; }
    
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
/* --- TIMER MODE TOGGLE SWITCH STYLING --- */

/* The switch container setup */
.setting-group .switch {
  position: relative;
  display: inline-block;
  width: 60px; /* Width of the switch track */
  height: 34px; /* Height of the switch track */
}

/* Hide the default HTML checkbox */
.setting-group .switch input { 
  opacity: 0; 
  width: 0; 
  height: 0; 
}

/* The slider/track */
.setting-group .slider {
  position: absolute;
  cursor: pointer;
  top: 0; left: 0; right: 0; bottom: 0;
  /* Default (OFF) state background color */
  background-color: #ccc; 
  transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); /* Smooth slide transition */
  border-radius: 34px; /* Rounded pill shape */
  box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1); /* Inner shadow for depth */
}

/* Dark Mode OFF State */
.dark-mode .setting-group .slider {
    background-color: #555; /* Darker off state in dark mode */
}

/* The circular thumb/handle */
.setting-group .slider:before {
  position: absolute;
  content: "";
  height: 26px; /* Size of the handle */
  width: 26px;
  left: 4px; 
  bottom: 4px;
  background-color: white; /* White handle */
  transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  border-radius: 50%; /* Perfect circle */
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3); /* Shadow on the handle */
}

/* ON State: When the checkbox is checked */
input#timerToggle:checked + .slider { 
  background: var(--primary-gradient); /* Use the theme gradient when ON */
  box-shadow: 0 0 10px rgba(0, 114, 255, 0.5); /* Outer glow when ON */
}

/* Move the handle to the right for the ON state */
input#timerToggle:checked + .slider:before { 
  transform: translateX(26px); 
}

/* Optional: Bouncy feedback on hover for the whole track/slider */
.setting-group .slider:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
}
/* --- SECONDARY BUTTON STYLING (.secondary-btn) --- */

.secondary-btn {
  height: 20px;
  padding: 18px;
  border-radius: 18px;
  font-size: 1.1rem;
  font-weight: 800;
  cursor: pointer;
  width: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  text-decoration: none;
  box-sizing: border-box;
  letter-spacing: 0.5px;
  background: transparent;
  border: 2px solid var(--accent-color); /* Light mode: Uses accent-color border (e.g., #ff416c) */
  color: var(--accent-color);
  margin-top: 10px; /* Default spacing */
  transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55); 
}

/* Dark Mode Adaptation */
.dark-mode .secondary-btn {
    /* In dark mode, border and text should be subtle white/light gray */
    border-color: rgba(255, 255, 255, 0.2); 
    color: var(--text-dark); /* Match the main body text color */
}

/* Hover/Focus States: The Bouncy Effect */
.secondary-btn:hover {
  background: var(--accent-color); /* Fills with accent color */
  color: white; /* Text turns white on hover */
  transform: translateY(-5px) scale(1.02); /* Bouncy lift */
  /* Consistent shadow effect */
  box-shadow: 0 10px 20px rgba(255, 65, 108, 0.3);
}

/* Active State: The Press Down Effect */
.secondary-btn:active {
    transform: translateY(-2px) scale(0.98); /* Press down effect */
    box-shadow: none;
}
  </style>
</head>
<body>
  
  <div class="blob-container">
    <div class="blob" id="blob1"></div>
    <div class="blob" id="blob2"></div>
    <div class="blob" id="blob3"></div>
  </div>
  
  <div class="ui-controls-right">
    <button class="icon-btn" onclick="toggleMusic()" id="music-btn" title="Toggle Music">
      <span class="material-icons">music_note</span>
    </button>
    <button class="icon-btn" onclick="showGuide()" title="How to Play">
      <span class="material-icons">help_outline</span>
    </button>
    <button class="mode-toggle icon-btn" onclick="toggleMode()" title="Switch Theme">
      <span class="material-icons">brightness_6</span>
    </button>
  </div>


  <div class="game-container">
    <h1 class="game-title">Rock Paper Scissors</h1>
    
    <div class="settings visible-fade" id="settings-panel">
      <div class="setting-group">
        <label>Target Score (Max 10)</label>
        <input type="number" id="targetPoints" min="1" max="10" value="5" class="pop-input" placeholder="e.g. 5"/>
      </div>
      
      <div class="setting-group" style="margin-top: 1.5rem;">
        <label>Difficulty</label>
        <div class="difficulty-selector">
          <button class="diff-btn selected" onclick="setDifficulty('easy')">Easy</button>
          <button class="diff-btn" onclick="setDifficulty('medium')">Medium</button>
          <button class="diff-btn" onclick="setDifficulty('hard')">Hard</button>
        </div>
      </div>

      <div class="setting-group" style="margin-top: 1.5rem; display: flex; justify-content: space-between; align-items: center;">
        <label style="margin-bottom: 0;">Timer Mode (10s Limit)</label>
        <label class="switch">
          <input type="checkbox" id="timerToggle" checked>
          <span class="slider round"></span>
        </label>
      </div>

      <button id="startGame" class="btn primary-btn" style="margin-top: 2rem;">Start Game</button>
      <button onclick="location.href='mini-games.html'" class="exit btn secondary-btn">Go to mini-games</button>
    </div>

    <div id="game-area" class="hidden-fade">
      
      <div class="scoreboard">
        <div class="score-box player">
          <p style="margin-bottom: 5px;">You</p>
          <div class="score-number" id="playerScore">0</div>
        </div>
        
        <div class="timer-display hidden" id="timer-display">
          <span class="material-icons">timer</span>
          <span id="time-left">10</span>s
        </div>

        <div class="score-box computer">
          <p style="margin-bottom: 5px;">Bot <span class="badge" id="bot-badge" style="font-size: 0.7rem; background: var(--primary-gradient); color: white; padding: 3px 8px; border-radius: 6px; vertical-align: middle; font-weight: bold;">Easy</span></p>
          <div class="score-number" id="computerScore">0</div>
        </div>
      </div>

      <div class="hands-stage">
        <div class="hand-container">
          <span class="hand" id="playerHand">‚úä</span>
        </div>
        <div class="hand-container">
          <span class="hand" id="computerHand">‚úä</span>
        </div>
      </div>

      <div class="message-area">
        <h2 id="round-status">Choose your weapon!</h2>
      </div>

      <div class="choices">
        <button class="choice-btn" data-choice="rock">
          <div class="emoji">‚úä</div>
          <span>Rock</span>
        </button>
        <button class="choice-btn" data-choice="paper">
          <div class="emoji">üìÑ</div>
          <span>Paper</span>
        </button>
        <button class="choice-btn" data-choice="scissors">
          <div class="emoji">‚úÇÔ∏è</div>
          <span>Scissors</span>
        </button>
      </div>
      <button onclick="returnToSettings()" class="secondary-btn" style="margin-top: 20px; max-width: 400px;">Return to Settings</button>
    </div>
  </div>

  <div id="overlay" class="overlay-result hidden">
    <div class="result-card">
      <div id="result-emoji" style="font-size: 4rem; margin-bottom: 1rem;">üèÜ</div>
      <h2 class="final-message" id="finalMessage">VICTORY ACHIEVED!</h2>
      <p id="final-score" style="font-size: 1.5rem; font-weight: 700;"></p>
      <button class="btn primary-btn" onclick="location.reload()">Play Again</button>
    </div>
  </div>

  <div class="modal-overlay" id="guide-modal">
    <div class="modal-card">
      <h2 style="text-align: center; font-size: 2rem; background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">üìñ How to Play</h2>
      <div class="guide-steps">
        <div class="step">
          <span class="step-icon" style="font-size: 1.8rem;">üéØ</span>
          <p><strong>Objective:</strong> Reach the **Target Score** before the Bot does.</p>
        </div>
        <div class="step">
          <span class="step-icon" style="font-size: 1.8rem;">üß†</span>
          <p><strong>Difficulty - Hard:</strong> The bot analyzes your move history to **predict your next choice** and counter it!</p>
        </div>
        <div class="step">
          <span class="step-icon" style="font-size: 1.8rem;">‚öîÔ∏è</span>
          <p><strong>Rules:</strong> Rock crushes Scissors, Scissors cuts Paper, Paper covers Rock.</p>
        </div>
        <div class="step">
          <span class="step-icon" style="font-size: 1.8rem;">‚è±Ô∏è</span>
          <p><strong>Timer Mode:</strong> Make a move within **10 seconds**, or a random one is chosen!</p>
        </div>
      </div>
      <button class="btn primary-btn" onclick="closeGuide()">Got it!</button>
    </div>
  </div>

  <canvas id="fireworks" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 150;"></canvas>

  <audio id="bgm" src="sounds/bgm.mp3" loop></audio>
  <audio id="winSound" src="sounds/win.mp3"></audio>
  <audio id="loseSound" src="sounds/lose.mp3"></audio>
  <audio id="clickSound" src="sounds/click.mp3"></audio>
  <audio id="gameOverSound" src="sounds/gameover.mp3"></audio>
  <audio id="timerSound" src="sounds/timer.mp3"></audio>

  <script>
    
    /*
     * ----------------------------------------------------
     * JAVASCRIPT LOGIC - STATE & ELEMENTS
     * ----------------------------------------------------
     */

    const state = {
      playerScore: 0,
      computerScore: 0,
      targetPoints: 5,
      difficulty: 'easy',
      timerEnabled: true,
      timerDuration: 10,
      timeLeft: 10,
      isPlaying: false,
      musicEnabled: false,
      playerHistory: [],
      timerInterval: null
    };

    const choices = ['rock', 'paper', 'scissors'];
    const emojis = { rock: '‚úä', paper: 'üìÑ', scissors: '‚úÇÔ∏è' };

    // Elements
    const startBtn = document.getElementById('startGame');
    const settingsPanel = document.getElementById('settings-panel');
    const gameArea = document.getElementById('game-area');
    const overlay = document.getElementById('overlay');
    const playerHand = document.getElementById('playerHand');
    const computerHand = document.getElementById('computerHand');
    const roundStatus = document.getElementById('round-status');
    const timerDisplay = document.getElementById('timer-display');
    const timeLeftEl = document.getElementById('time-left');
    const choiceButtons = document.querySelectorAll('.choice-btn');
    const playerScoreEl = document.getElementById('playerScore');
    const computerScoreEl = document.getElementById('computerScore');

    // Sounds
    const sounds = {
      win: document.getElementById('winSound'),
      lose: document.getElementById('loseSound'),
      click: document.getElementById('clickSound'),
      gameover: document.getElementById('gameOverSound'),
      timer: document.getElementById('timerSound'),
      bgm: document.getElementById('bgm')
    };
    
    // Utility for smooth transitions on visibility change
    function togglePanelVisibility(showPanel, hidePanel) {
        hidePanel.classList.remove('visible-fade');
        hidePanel.classList.add('hidden-fade');
        
        // Wait for fade-out to finish before making the panel display: none
        setTimeout(() => {
            hidePanel.classList.add('hidden');
            
            showPanel.classList.remove('hidden');
            // Small delay before fade-in starts
            setTimeout(() => {
                showPanel.classList.remove('hidden-fade');
                showPanel.classList.add('visible-fade');
            }, 50); 

        }, 500); // Must match CSS transition duration of hidden-fade
    }

    /* --- Initialization --- */
    document.addEventListener('DOMContentLoaded', () => {
      // Apply saved theme
      if(localStorage.getItem('rps-theme') === 'dark') {
        document.body.classList.add('dark-mode');
      }
      
      choiceButtons.forEach(btn => {
        btn.addEventListener('click', () => makeMove(btn.dataset.choice));
      });
      
      startBtn.addEventListener('click', startGame);
      
      if(sounds.bgm) sounds.bgm.volume = 0.3;
      document.getElementById('bot-badge').innerText = 'Easy';
      
      // Initial state setup to ensure animations work correctly
      gameArea.classList.add('hidden', 'hidden-fade');
      settingsPanel.classList.remove('hidden', 'hidden-fade');
      settingsPanel.classList.add('visible-fade');
    });

    /* --- UI Functions --- */

    function toggleMode() {
      document.body.classList.toggle('dark-mode');
      localStorage.setItem('rps-theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
    }

    function toggleMusic() {
      state.musicEnabled = !state.musicEnabled;
      const btn = document.getElementById('music-btn');
      btn.innerHTML = `<span class="material-icons">${state.musicEnabled ? 'music_note' : 'music_off'}</span>`;
      
      if (state.musicEnabled) {
        sounds.bgm.play().catch(e => console.warn("Audio blocked:", e));
      } else {
        sounds.bgm.pause();
      }
    }

    function showGuide() {
      document.getElementById('guide-modal').classList.add('active');
    }

    function closeGuide() {
      document.getElementById('guide-modal').classList.remove('active');
    }

    function setDifficulty(level) {
      state.difficulty = level;
      playSound('click');
      document.querySelectorAll('.diff-btn').forEach(btn => {
        btn.classList.toggle('selected', btn.innerText.toLowerCase() === level);
      });
      document.getElementById('bot-badge').innerText = level.charAt(0).toUpperCase() + level.slice(1);
    }
    
    function playSound(name) {
      const sound = sounds[name];
      if (sound) {
        sound.currentTime = 0;
        sound.play().catch(()=>{});
      }
    }
    
    function returnToSettings() {
        if(state.timerInterval) clearInterval(state.timerInterval);
        state.isPlaying = false;
        playSound('click');
        togglePanelVisibility(settingsPanel, gameArea);
    }

    /* --- Core Game Logic --- */

    function startGame() {
      playSound('click');
      
      let inputVal = parseInt(document.getElementById('targetPoints').value);
      if (inputVal > 10) inputVal = 10;
      if (inputVal < 1 || isNaN(inputVal)) inputVal = 1;
      
      document.getElementById('targetPoints').value = inputVal;
      state.targetPoints = inputVal;

      state.timerEnabled = document.getElementById('timerToggle').checked;
      state.playerScore = 0;
      state.computerScore = 0;
      state.playerHistory = [];
      state.isPlaying = true;
      
      updateScoreboard();
      
      togglePanelVisibility(gameArea, settingsPanel);
      overlay.classList.add('hidden');
      
      if(state.timerEnabled) {
        timerDisplay.classList.remove('hidden');
        startTimer();
      } else {
        timerDisplay.classList.add('hidden');
      }
      
      roundStatus.innerText = "Choose your weapon!";
      roundStatus.style.color = '';
      enableChoiceButtons(true);
      playerHand.innerText = '‚úä';
      computerHand.innerText = '‚úä';
    }

    function startTimer() {
      state.timeLeft = state.timerDuration;
      timeLeftEl.innerText = state.timeLeft;
      timeLeftEl.style.color = 'inherit';
      clearInterval(state.timerInterval);
      
      state.timerInterval = setInterval(() => {
        state.timeLeft--;
        timeLeftEl.innerText = state.timeLeft;
        
        if(state.timeLeft <= 3 && state.timeLeft > 0) {
          playSound('timer');
          timeLeftEl.style.color = '#ff416c'; 
          timerDisplay.classList.add('score-pop'); // Animated pulse on timer
        } else {
          timeLeftEl.style.color = 'inherit';
          timerDisplay.classList.remove('score-pop');
        }
        
        if(state.timeLeft <= 0) {
          clearInterval(state.timerInterval);
          handleTimeout();
        }
      }, 1000);
    }

    function handleTimeout() {
      roundStatus.innerText = "Time's up! Random move selected.";
      const randomMove = choices[Math.floor(Math.random() * choices.length)];
      makeMove(randomMove);
    }
    
    function enableChoiceButtons(enable) {
        choiceButtons.forEach(btn => {
            btn.classList.toggle('disabled', !enable);
        });
    }

    function makeMove(playerChoice) {
      if(!state.isPlaying) return;
      
      clearInterval(state.timerInterval);
      state.isPlaying = false; 
      enableChoiceButtons(false); 

      playSound('click');
      playerHand.innerText = '‚úä';
      computerHand.innerText = '‚úä';
      
      // Start the animated shake immediately
      playerHand.classList.add('shake-player');
      computerHand.classList.add('shake-computer');
      
      // Delay the result reveal by 1 second (matches shake animation duration)
      setTimeout(() => { 
        const computerChoice = getComputerMove(playerChoice);
        resolveRound(playerChoice, computerChoice);
        
        // Remove shake classes after the animation is complete
        playerHand.classList.remove('shake-player');
        computerHand.classList.remove('shake-computer');
        
        state.playerHistory.push(playerChoice);
      }, 1000); 
    }
    
    /* ----------------------------------------------------
     * BOT LOGIC (MEDIUM & HARD IMPLEMENTATION)
     * ----------------------------------------------------
     */

    function getCounterMove(move) {
      if (move === 'rock') return 'paper';
      if (move === 'paper') return 'scissors';
      return 'rock';
    }

    function getPredictedMove() {
      if (state.playerHistory.length < 2) return null;

      const lastMove = state.playerHistory[state.playerHistory.length - 1]; 
      const historyPairs = {};

      for (let i = 0; i < state.playerHistory.length - 1; i++) {
        if (state.playerHistory[i] === lastMove) {
          const nextMove = state.playerHistory[i + 1];
          historyPairs[nextMove] = (historyPairs[nextMove] || 0) + 1;
        }
      }

      let predictedMove = null;
      let maxCount = 0;
      for (const move in historyPairs) {
        if (historyPairs[move] >= 2 && historyPairs[move] > maxCount) {
          maxCount = historyPairs[move];
          predictedMove = move;
        }
      }

      return predictedMove;
    }


    function getComputerMove(playerMove) {
      const r = Math.random();
      const previousPlayerMove = state.playerHistory[state.playerHistory.length - 1]; 

      if (state.difficulty === 'easy') {
        return choices[Math.floor(Math.random() * choices.length)];
      } 
      else if (state.difficulty === 'medium') {
        // 40% chance to counter the player's PREVIOUS move
        if (previousPlayerMove && r > 0.6) { 
          return getCounterMove(previousPlayerMove);
        }
        return choices[Math.floor(Math.random() * choices.length)];
      } 
      else { // Hard
        const predictedMove = getPredictedMove();
        
        // 70% chance to counter the predicted pattern move
        if (predictedMove && r > 0.3) { 
          return getCounterMove(predictedMove);
        }
        
        // 20% chance to counter the CURRENT player move 
        if (r > 0.8) { 
            return getCounterMove(playerMove);
        }
        
        return choices[Math.floor(Math.random() * choices.length)];
      }
    }

    /* ----------------------------------------------------
     * ROUND RESOLUTION & ENDGAME
     * ----------------------------------------------------
     */

    function resolveRound(pChoice, cChoice) {
      playerHand.innerText = emojis[pChoice];
      computerHand.innerText = emojis[cChoice];
      
      let result = '';
      let resultColor = '';
      
      if (pChoice === cChoice) {
        result = 'draw';
        roundStatus.innerText = `It's a Draw! (${emojis[pChoice]})`;
        resultColor = '#888';
      } else if (
        (pChoice === 'rock' && cChoice === 'scissors') ||
        (pChoice === 'paper' && cChoice === 'rock') ||
        (pChoice === 'scissors' && cChoice === 'paper')
      ) {
        result = 'win';
        state.playerScore++;
        roundStatus.innerText = `You Win! ${emojis[pChoice]} beats ${emojis[cChoice]}`;
        resultColor = '#0072ff';
        playSound('win');
        playerScoreEl.parentElement.classList.add('score-pop');
      } else {
        result = 'lose';
        state.computerScore++;
        roundStatus.innerText = `Bot Wins! ${emojis[cChoice]} beats ${emojis[pChoice]}`;
        resultColor = '#ff416c';
        playSound('lose');
        computerScoreEl.parentElement.classList.add('score-pop');
      }
      
      roundStatus.style.color = resultColor;
      updateScoreboard();
      
      if (state.playerScore >= state.targetPoints || state.computerScore >= state.targetPoints) {
        endGame();
      } else {
        // Wait for 1.5s, then restart round
        setTimeout(() => {
          state.isPlaying = true;
          enableChoiceButtons(true);
          playerHand.innerText = '‚úä';
          computerHand.innerText = '‚úä';
          roundStatus.innerText = "Choose your weapon!";
          roundStatus.style.color = 'inherit';
          playerScoreEl.parentElement.classList.remove('score-pop');
          computerScoreEl.parentElement.classList.remove('score-pop');
          if(state.timerEnabled) startTimer();
        }, 1500);
      }
    }

    function updateScoreboard() {
      playerScoreEl.innerText = state.playerScore;
      computerScoreEl.innerText = state.computerScore;
    }

    function endGame() {
      const won = state.playerScore > state.computerScore;
      playSound('gameover');
      
      document.getElementById('result-emoji').innerText = won ? 'üèÜ' : 'ü§ñ';
      document.getElementById('finalMessage').innerText = won ? 'VICTORY ACHIEVED!' : 'DEFEAT... BOT WINS';
      document.getElementById('final-score').innerText = `Final Score: ${state.playerScore} - ${state.computerScore}`;
      
      overlay.classList.remove('hidden');
      
      if (won) {
        startFireworks();
      }
    }

    /* --- Fireworks System --- */
    const canvas = document.getElementById('fireworks');
    const ctx = canvas.getContext('2d');
    let fireworks = [];
    let animationId = null;

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    class Particle {
      constructor(x, y, color) {
        this.x = x;
        this.y = y;
        this.color = color;
        this.velocity = {
          x: (Math.random() - 0.5) * 10,
          y: (Math.random() - 0.5) * 10
        };
        this.alpha = 1;
        this.friction = 0.95;
      }

      draw() {
        ctx.globalAlpha = this.alpha;
        ctx.beginPath();
        ctx.arc(this.x, this.y, 3, 0, Math.PI * 2);
        ctx.fillStyle = this.color;
        ctx.fill();
        ctx.globalAlpha = 1;
      }

      update() {
        this.velocity.x *= this.friction;
        this.velocity.y *= this.friction;
        this.x += this.velocity.x;
        this.y += this.velocity.y;
        this.alpha -= 0.02;
      }
    }

    function startFireworks() {
      if (animationId) cancelAnimationFrame(animationId);
      fireworks = [];
      
      const animate = () => {
        // Stop animation if overlay is hidden
        if(overlay.classList.contains('hidden')) {
             if (animationId) cancelAnimationFrame(animationId);
             ctx.clearRect(0, 0, canvas.width, canvas.height);
             return;
        }
        
        animationId = requestAnimationFrame(animate);
        
        // Trail effect
        ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        if (Math.random() < 0.08) {
          const x = Math.random() * canvas.width;
          const y = Math.random() * canvas.height * 0.4 + (canvas.height * 0.1); 
          const color = `hsl(${Math.random() * 360}, 70%, 60%)`;
          
          for (let i = 0; i < 60; i++) {
            fireworks.push(new Particle(x, y, color));
          }
        }
        
        fireworks.forEach((p, index) => {
          if (p.alpha > 0) {
            p.update();
            p.draw();
          } else {
            fireworks.splice(index, 1);
          }
        });
      };
      
      animate();
    }
  </script>
</body>
</html>
